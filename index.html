<script type="module">
    import { db } from "./firebase-config.js";
    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

    async function revealCode() {
        const urlParams = new URLSearchParams(window.location.search);
        const codeId = urlParams.get("code"); // Get unique ID from URL

        if (!codeId) {
            document.getElementById("errorMessage").innerText = "Invalid QR Code!";
            return;
        }

        try {
            const codeRef = doc(db, "codes", codeId);
            const codeSnap = await getDoc(codeRef);

            if (codeSnap.exists()) {
                document.getElementById("secretCode").innerText = codeSnap.data().secretCode;
                document.getElementById("secretCode").style.display = "block";
                document.getElementById("errorMessage").innerText = "";
            } else {
                document.getElementById("errorMessage").innerText = "Invalid QR Code!";
            }
        } catch (error) {
            console.error("‚ùå Error fetching secret code:", error);
            document.getElementById("errorMessage").innerText = "Error loading secret.";
        }
    }

    window.revealCode = revealCode;
</script>
